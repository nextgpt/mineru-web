import{d as H,a as W,r as p,c as b,o as X,b as h,e as a,f as n,g as L,h as y,w as r,i as _,j as G,n as I,k as x,l as U,u as V,m as C,p as J,t as m,q as S,s as K,v as Q,x as Y,y as u,E as P,_ as Z}from"./index-3p_sB7V1.js";import{a as ee}from"./index-DHr9lByg.js";import{g as se}from"./user-DmwaAHDW.js";import{u as te}from"./project-CkqIgJ0n.js";import{r as j,O as ae}from"./ragflow-Cczd1rK0.js";const le=ee.create({baseURL:"/api",timeout:5e3}),oe={getStats(){return le.get("/stats",{headers:{"X-User-Id":se()}}).then(o=>o.data)}},de=H("stats",{state:()=>({totalFiles:0,todayUploads:0,usedSpace:0,recentFiles:[]}),actions:{async fetchStats(){try{const o=await oe.getStats();this.totalFiles=o.totalFiles,this.todayUploads=o.todayUploads,this.usedSpace=o.usedSpace,this.recentFiles=o.recentFiles}catch(o){console.error("获取统计数据失败:",o),this.totalFiles=42,this.todayUploads=5,this.usedSpace=256,this.recentFiles=[]}}}}),re={class:"home-container"},ie={class:"home-content"},ce={class:"upload-section"},ne={class:"upload-content"},ue={class:"upload-text"},pe={class:"upload-title"},ve={class:"upload-hint"},fe={key:0,class:"upload-actions"},_e={class:"quick-actions"},me={class:"status-content"},ge={class:"status-icon"},he={class:"status-message"},ye={class:"status-main-text"},Se={key:0,class:"status-detail-text"},we={key:0,class:"status-progress"},ke={class:"progress-text"},xe=".pdf,.doc,.docx",Ce=W({__name:"Home",setup(o){const M=Y(),O=de(),w=te(),D=p(),t=p(null),i=p(!1),v=p(!1),e=p({title:"",message:"",detail:"",type:"loading",progress:0,closable:!1}),k=p(null),z=b(()=>i.value?"正在处理文件...":t.value?`已选择: ${t.value.name}`:"拖拽文件到此处或点击上传"),B=b(()=>i.value?"请耐心等待，正在上传和解析文档":t.value?'点击"开始上传"按钮开始处理':"支持 PDF、DOC、DOCX 格式，最大 200MB"),N=()=>{switch(e.value.type){case"loading":return C;case"success":return Q;case"error":return K;default:return C}},T=l=>/\.(pdf|doc|docx)$/i.test(l.name)?(l.size<=200*1024*1024||P.error("文件大小不能超过 200MB"),!1):(P.error("只支持 PDF、DOC、DOCX 格式的文件"),!1),$=l=>{l.raw&&(t.value=l.raw)},R=async()=>{var l;if(t.value){i.value=!0,v.value=!0,e.value={title:"文件上传",message:"正在上传文件...",detail:t.value.name,type:"loading",progress:0,closable:!1};try{const s={id:Date.now().toString(),name:t.value.name.replace(/\.[^/.]+$/,""),fileName:t.value.name,fileSize:t.value.size,uploadTime:new Date().toISOString(),status:"uploading",lastModified:new Date().toISOString()};w.addProject(s);const d=await j.uploadAndParseDocument(t.value,(f,c)=>{e.value.progress=f,e.value.message=c,e.value.detail=t.value.name},(f,c,g)=>{e.value.progress=f,e.value.message=c,e.value.detail=g?`当前阶段: ${g}`:""});d.status===ae.SUCCESS?(k.value=d.data,w.updateProject(s.id,{status:"ready",documentId:d.data.documentId,datasetId:j.getFixedDatasetId(),lastModified:new Date().toISOString()}),e.value={title:"上传成功",message:"文件上传和解析完成！",detail:"您可以开始生成标书大纲了",type:"success",progress:100,closable:!0},t.value=null,(l=D.value)==null||l.clearFiles()):(w.updateProject(s.id,{status:"error",lastModified:new Date().toISOString()}),e.value={title:"上传失败",message:d.message,detail:d.error||"请检查文件格式或网络连接",type:"error",progress:0,closable:!0})}catch(s){console.error("Upload error:",s),e.value={title:"上传失败",message:"文件上传过程中发生错误",detail:s.message||"未知错误",type:"error",progress:0,closable:!0}}finally{i.value=!1}}},A=()=>{v.value=!1,k.value=null},E=()=>{v.value=!1,M.push("/projects")};return X(()=>{O.fetchStats()}),(l,s)=>{const d=_("el-icon"),f=_("el-upload"),c=_("el-button"),g=_("el-progress"),q=_("el-dialog");return u(),h("div",re,[a("div",ie,[s[4]||(s[4]=L('<div class="title-section" data-v-121dcf01><h1 class="main-title" data-v-121dcf01> 通过招标文件<span class="highlight" data-v-121dcf01>智能生成标书</span></h1><p class="subtitle" data-v-121dcf01> 上传招标文档，AI智能解析，快速生成专业标书内容，提升中标率 </p><p class="description" data-v-121dcf01> 支持 PDF、Word 等多种格式，智能提取关键信息 </p></div><div class="features-row" data-v-121dcf01><div class="feature-item" data-v-121dcf01><div class="feature-icon pdf-icon" data-v-121dcf01>PDF</div><span class="feature-text" data-v-121dcf01>PDF文档解析</span></div><div class="feature-item" data-v-121dcf01><div class="feature-icon word-icon" data-v-121dcf01>W</div><span class="feature-text" data-v-121dcf01>Word文档支持</span></div><div class="feature-item" data-v-121dcf01><div class="feature-icon ai-icon" data-v-121dcf01>AI</div><span class="feature-text" data-v-121dcf01>智能内容生成</span></div></div>',2)),a("div",ce,[n(f,{ref_key:"uploadRef",ref:D,class:"upload-dragger",drag:"","auto-upload":!1,"show-file-list":!1,accept:xe,"before-upload":T,"on-change":$,disabled:i.value},{default:r(()=>[a("div",ne,[n(d,{class:I(["upload-icon",{"is-loading":i.value}])},{default:r(()=>[(u(),x(U(i.value?V(C):V(J))))]),_:1},8,["class"]),a("div",ue,[a("p",pe,m(z.value),1),a("p",ve,m(B.value),1)])])]),_:1},8,["disabled"]),t.value&&!i.value?(u(),h("div",fe,[n(c,{type:"primary",size:"large",onClick:R,class:"action-btn"},{default:r(()=>s[2]||(s[2]=[S(" 开始上传解析 ")])),_:1,__:[2]})])):y("",!0)]),a("div",_e,[n(c,{class:"quick-btn",onClick:s[0]||(s[0]=F=>l.$router.push("/projects"))},{default:r(()=>s[3]||(s[3]=[S(" 查看项目管理 ")])),_:1,__:[3]})])]),n(q,{modelValue:v.value,"onUpdate:modelValue":s[1]||(s[1]=F=>v.value=F),title:e.value.title,width:"500px","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":e.value.closable,center:"",class:"status-modal"},G({default:r(()=>[a("div",me,[a("div",ge,[n(d,{class:I(["status-icon-inner",e.value.type==="loading"?"is-loading":"",e.value.type==="success"?"success":"",e.value.type==="error"?"error":""])},{default:r(()=>[(u(),x(U(N())))]),_:1},8,["class"])]),a("div",he,[a("p",ye,m(e.value.message),1),e.value.detail?(u(),h("p",Se,m(e.value.detail),1)):y("",!0)]),e.value.type==="loading"?(u(),h("div",we,[n(g,{percentage:e.value.progress,"stroke-width":8,"show-text":!1},null,8,["percentage"]),a("div",ke,m(e.value.progress)+"%",1)])):y("",!0)])]),_:2},[e.value.closable?{name:"footer",fn:r(()=>[n(c,{onClick:A},{default:r(()=>s[5]||(s[5]=[S("关闭")])),_:1,__:[5]}),e.value.type==="success"&&k.value?(u(),x(c,{key:0,type:"primary",onClick:E},{default:r(()=>s[6]||(s[6]=[S(" 查看项目 ")])),_:1,__:[6]})):y("",!0)]),key:"0"}:void 0]),1032,["modelValue","title","show-close"])])}}}),Ve=Z(Ce,[["__scopeId","data-v-121dcf01"]]);export{Ve as default};
