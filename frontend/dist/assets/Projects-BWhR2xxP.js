import{a as oe,j as r,q as ne,o as se,c as C,b as n,f as t,w as o,r as s,G as re,O as ie,k as de,E as p,e as u,u as z,g as ue,P as ce,m as pe,t as v,h as me,n as P,z as _e,i as y,A as fe,_ as ge}from"./index-BHN-jLFm.js";import{p as S}from"./projects-B10Zn0n3.js";import"./user-COjPqb4h.js";const ve={class:"projects-page"},ye={class:"page-header"},he={class:"header-right"},be={class:"page-content"},we={class:"search-bar"},Ce={class:"projects-table"},xe={class:"project-name"},je={class:"name-text"},Ve={key:0,class:"description-text"},ke={key:0,class:"file-info"},ze={class:"file-name"},Pe={key:1,class:"no-file"},Se={class:"pagination-wrapper"},Me={class:"dialog-footer"},Te=oe({__name:"Projects",setup($e){const M=_e(),T=r([]),x=r(!1),h=r(!1),j=r(""),$=r(""),c=r(1),b=r(10),B=r(0),f=r(!1),w=r(),i=ne({name:"",description:""}),N={name:[{required:!0,message:"请输入项目名称",trigger:"blur"},{min:1,max:100,message:"项目名称长度在 1 到 100 个字符",trigger:"blur"}]},E=l=>({created:"info",parsing:"warning",analyzing:"warning",outline_generated:"primary",document_generating:"primary",completed:"success",failed:"danger"})[l]||"info",q=l=>({created:"已创建",parsing:"解析中",analyzing:"分析中",outline_generated:"大纲已生成",document_generating:"生成中",completed:"已完成",failed:"失败"})[l]||l,A=l=>new Date(l).toLocaleString("zh-CN"),m=async()=>{try{x.value=!0;const l=await S.getProjects(c.value,b.value,j.value||void 0);T.value=l.projects,B.value=l.total}catch(l){console.error("加载项目列表失败:",l),p.error("加载项目列表失败")}finally{x.value=!1}};let D;const I=()=>{clearTimeout(D),D=setTimeout(()=>{c.value=1,m()},500)},G=()=>{c.value=1,m()},L=l=>{b.value=l,c.value=1,m()},O=l=>{c.value=l,m()},Q=l=>{U(l)},U=l=>{M.push(`/projects/${l.id}`)},H=l=>{p.info("编辑功能开发中...")},J=async l=>{try{await fe.confirm(`确定要删除项目"${l.name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await S.deleteProject(l.id),p.success("项目删除成功"),m()}catch(e){e!=="cancel"&&(console.error("删除项目失败:",e),p.error("删除项目失败"))}},K=l=>{var e;if(h.value){p.warning("正在创建项目，请稍候...");return}i.name="",i.description="",(e=w.value)==null||e.clearValidate(),l()},W=async()=>{if(w.value)try{if(!await w.value.validate())return;h.value=!0;const e=await S.createProject(i);p.success("项目创建成功"),f.value=!1,M.push(`/projects/${e.id}`)}catch(l){console.error("创建项目失败:",l),p.error("创建项目失败")}finally{h.value=!1}};return se(()=>{m()}),(l,e)=>{const V=s("el-icon"),_=s("el-button"),k=s("el-input"),d=s("el-option"),X=s("el-select"),g=s("el-table-column"),Y=s("el-tag"),Z=s("el-table"),ee=s("el-pagination"),F=s("el-form-item"),te=s("el-form"),ae=s("el-dialog"),le=ie("loading");return y(),C("div",ve,[n("div",ye,[e[10]||(e[10]=n("div",{class:"header-left"},[n("h1",{class:"page-title"},"项目管理"),n("p",{class:"page-subtitle"},"管理您的招标项目和生成的标书")],-1)),n("div",he,[t(_,{type:"primary",onClick:e[0]||(e[0]=a=>f.value=!0)},{default:o(()=>[t(V,null,{default:o(()=>[t(z(ue))]),_:1}),e[9]||(e[9]=u(" 新建项目 "))]),_:1,__:[9]})])]),n("div",be,[n("div",we,[t(k,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=a=>j.value=a),placeholder:"搜索项目名称...",clearable:"",onInput:I,style:{width:"300px"}},{prefix:o(()=>[t(V,null,{default:o(()=>[t(z(ce))]),_:1})]),_:1},8,["modelValue"]),t(X,{modelValue:$.value,"onUpdate:modelValue":e[2]||(e[2]=a=>$.value=a),placeholder:"筛选状态",clearable:"",onChange:G,style:{width:"150px","margin-left":"16px"}},{default:o(()=>[t(d,{label:"全部状态",value:""}),t(d,{label:"已创建",value:"created"}),t(d,{label:"解析中",value:"parsing"}),t(d,{label:"分析中",value:"analyzing"}),t(d,{label:"大纲已生成",value:"outline_generated"}),t(d,{label:"生成中",value:"document_generating"}),t(d,{label:"已完成",value:"completed"}),t(d,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),n("div",Ce,[re((y(),de(Z,{data:T.value,"empty-text":"暂无项目数据",onRowClick:Q,style:{width:"100%"}},{default:o(()=>[t(g,{prop:"name",label:"项目名称","min-width":"200"},{default:o(({row:a})=>[n("div",xe,[n("span",je,v(a.name),1),a.description?(y(),C("span",Ve,v(a.description),1)):pe("",!0)])]),_:1}),t(g,{prop:"status",label:"状态",width:"120"},{default:o(({row:a})=>[t(Y,{type:E(a.status),size:"small"},{default:o(()=>[u(v(q(a.status)),1)]),_:2},1032,["type"])]),_:1}),t(g,{prop:"original_file",label:"招标文件",width:"200"},{default:o(({row:a})=>[a.original_file?(y(),C("div",ke,[t(V,null,{default:o(()=>[t(z(me))]),_:1}),n("span",ze,v(a.original_file.filename),1)])):(y(),C("span",Pe,"未上传"))]),_:1}),t(g,{prop:"created_at",label:"创建时间",width:"180"},{default:o(({row:a})=>[u(v(A(a.created_at)),1)]),_:1}),t(g,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a})=>[t(_,{size:"small",onClick:P(R=>U(a),["stop"])},{default:o(()=>e[11]||(e[11]=[u(" 查看 ")])),_:2,__:[11]},1032,["onClick"]),t(_,{size:"small",type:"primary",onClick:P(R=>H(a),["stop"])},{default:o(()=>e[12]||(e[12]=[u(" 编辑 ")])),_:2,__:[12]},1032,["onClick"]),t(_,{size:"small",type:"danger",onClick:P(R=>J(a),["stop"])},{default:o(()=>e[13]||(e[13]=[u(" 删除 ")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[le,x.value]]),n("div",Se,[t(ee,{"current-page":c.value,"onUpdate:currentPage":e[3]||(e[3]=a=>c.value=a),"page-size":b.value,"onUpdate:pageSize":e[4]||(e[4]=a=>b.value=a),"page-sizes":[10,20,50,100],total:B.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:L,onCurrentChange:O},null,8,["current-page","page-size","total"])])])]),t(ae,{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=a=>f.value=a),title:"新建项目",width:"500px","before-close":K},{footer:o(()=>[n("span",Me,[t(_,{onClick:e[7]||(e[7]=a=>f.value=!1)},{default:o(()=>e[14]||(e[14]=[u("取消")])),_:1,__:[14]}),t(_,{type:"primary",onClick:W,loading:h.value},{default:o(()=>e[15]||(e[15]=[u(" 创建 ")])),_:1,__:[15]},8,["loading"])])]),default:o(()=>[t(te,{ref_key:"createFormRef",ref:w,model:i,rules:N,"label-width":"80px"},{default:o(()=>[t(F,{label:"项目名称",prop:"name"},{default:o(()=>[t(k,{modelValue:i.name,"onUpdate:modelValue":e[5]||(e[5]=a=>i.name=a),placeholder:"请输入项目名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(F,{label:"项目描述",prop:"description"},{default:o(()=>[t(k,{modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=a=>i.description=a),type:"textarea",rows:3,placeholder:"请输入项目描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}}),Fe=ge(Te,[["__scopeId","data-v-c005a12f"]]);export{Fe as default};
