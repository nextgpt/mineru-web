var d=Object.defineProperty;var g=(e,t,s)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var l=(e,t,s)=>g(e,typeof t!="symbol"?t+"":t,s);import{d as h}from"./index-3p_sB7V1.js";class i{static saveProject(t){const s=this.getAllProjects(),r=s.findIndex(o=>o.id===t.id);r>=0?s[r]={...t,lastModified:new Date().toISOString()}:s.push({...t,lastModified:new Date().toISOString()}),this.saveProjects(s)}static getProject(t){return this.getAllProjects().find(r=>r.id===t)||null}static getAllProjects(){try{const t=localStorage.getItem(this.PROJECTS_KEY);return t?JSON.parse(t):[]}catch(t){return console.error("Failed to load projects from localStorage:",t),[]}}static deleteProject(t){const s=this.getAllProjects().filter(r=>r.id!==t);this.saveProjects(s)}static updateProject(t,s){const r=this.getAllProjects(),o=r.findIndex(c=>c.id===t);o>=0&&(r[o]={...r[o],...s,lastModified:new Date().toISOString()},this.saveProjects(r))}static saveProjects(t){try{localStorage.setItem(this.PROJECTS_KEY,JSON.stringify(t))}catch(s){console.error("Failed to save projects to localStorage:",s)}}static clearAllProjects(){localStorage.removeItem(this.PROJECTS_KEY)}static saveSettings(t){try{const r={...this.getSettings(),...t};localStorage.setItem(this.SETTINGS_KEY,JSON.stringify(r))}catch(s){console.error("Failed to save settings to localStorage:",s)}}static getSettings(){try{const t=localStorage.getItem(this.SETTINGS_KEY);return t?JSON.parse(t):{}}catch(t){return console.error("Failed to load settings from localStorage:",t),{}}}static getSetting(t,s){const r=this.getSettings();return r[t]!==void 0?r[t]:s}static exportProjects(){const t=this.getAllProjects(),s=this.getSettings(),r={projects:t,settings:s,exportTime:new Date().toISOString(),version:"1.0.0"};return JSON.stringify(r,null,2)}static importProjects(t){try{const s=JSON.parse(t);if(!s.projects||!Array.isArray(s.projects))return{success:!1,message:"无效的数据格式"};for(const a of s.projects)if(!a.id||!a.name||!a.fileName)return{success:!1,message:"项目数据结构不完整"};const r=this.getAllProjects(),o=new Set(r.map(a=>a.id)),c=s.projects.filter(a=>!o.has(a.id)),n=[...r,...c];return this.saveProjects(n),s.settings&&this.saveSettings(s.settings),{success:!0,message:`成功导入 ${c.length} 个项目`}}catch(s){return console.error("Failed to import projects:",s),{success:!1,message:"导入失败：数据格式错误"}}}static getStorageUsage(){try{let t=0;for(let o in localStorage)localStorage.hasOwnProperty(o)&&(t+=localStorage[o].length+o.length);const s=5*1024*1024,r=Math.round(t/s*100);return{used:t,total:s,percentage:r}}catch(t){return console.error("Failed to get storage usage:",t),{used:0,total:0,percentage:0}}}static cleanupExpiredData(t=30){const s=this.getAllProjects(),r=new Date;r.setDate(r.getDate()-t);const o=s.filter(n=>new Date(n.lastModified)>r),c=s.length-o.length;return c>0&&this.saveProjects(o),c}}l(i,"PROJECTS_KEY","tender_projects"),l(i,"SETTINGS_KEY","tender_settings");const P=h("project",{state:()=>({projects:[],viewMode:"card",loading:!1,pagination:{page:1,pageSize:20,total:0},searchKeyword:"",selectedProject:void 0}),getters:{filteredProjects(){if(!this.searchKeyword)return this.projects;const e=this.searchKeyword.toLowerCase();return this.projects.filter(t=>t.name.toLowerCase().includes(e)||t.fileName.toLowerCase().includes(e))},paginatedProjects(){const e=this.filteredProjects,t=(this.pagination.page-1)*this.pagination.pageSize,s=t+this.pagination.pageSize;return e.slice(t,s)},projectsByStatus(){return this.projects.reduce((e,t)=>(e[t.status]||(e[t.status]=[]),e[t.status].push(t),e),{})},recentProjects(){return[...this.projects].sort((e,t)=>new Date(t.lastModified).getTime()-new Date(e.lastModified).getTime()).slice(0,5)}},actions:{async loadProjects(){this.loading=!0;try{this.projects=i.getAllProjects(),this.updatePagination()}catch(e){console.error("Failed to load projects:",e)}finally{this.loading=!1}},addProject(e){this.projects.unshift(e),i.saveProject(e),this.updatePagination()},updateProject(e,t){var r;const s=this.projects.findIndex(o=>o.id===e);s>=0&&(this.projects[s]={...this.projects[s],...t},i.updateProject(e,t),((r=this.selectedProject)==null?void 0:r.id)===e&&(this.selectedProject=this.projects[s]))},deleteProject(e){var t;this.projects=this.projects.filter(s=>s.id!==e),i.deleteProject(e),this.updatePagination(),((t=this.selectedProject)==null?void 0:t.id)===e&&(this.selectedProject=void 0)},selectProject(e){this.selectedProject=e},clearSelection(){this.selectedProject=void 0},setViewMode(e){this.viewMode=e,this.saveUserPreferences()},setSearchKeyword(e){this.searchKeyword=e,this.pagination.page=1,this.updatePagination()},setPagination(e,t){this.pagination.page=e,t&&(this.pagination.pageSize=t),this.updatePagination()},updatePagination(){this.pagination.total=this.filteredProjects.length},deleteMultipleProjects(e){this.projects=this.projects.filter(t=>!e.includes(t.id)),e.forEach(t=>i.deleteProject(t)),this.updatePagination(),this.selectedProject&&e.includes(this.selectedProject.id)&&(this.selectedProject=void 0)},exportProjects(){return i.exportProjects()},async importProjects(e){const t=i.importProjects(e);return t.success&&await this.loadProjects(),t},cleanupExpiredProjects(e=30){const t=i.cleanupExpiredData(e);return t>0&&this.loadProjects(),t},saveUserPreferences(){const e={viewMode:this.viewMode};i.saveSettings({userPreferences:e})},loadUserPreferences(){const t=i.getSettings().userPreferences;t&&t.viewMode&&(this.viewMode=t.viewMode)},getProjectStats(){var s,r,o,c,n,a;const e=this.projects.length,t=this.projectsByStatus;return{total:e,uploading:((s=t.uploading)==null?void 0:s.length)||0,parsing:((r=t.parsing)==null?void 0:r.length)||0,ready:((o=t.ready)==null?void 0:o.length)||0,generating:((c=t.generating)==null?void 0:c.length)||0,completed:((n=t.completed)==null?void 0:n.length)||0,error:((a=t.error)==null?void 0:a.length)||0}}}});export{P as u};
