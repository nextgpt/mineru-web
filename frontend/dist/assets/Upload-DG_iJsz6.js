import{a as S,j as f,c as y,b as s,f as a,k as C,w as t,r as d,e as r,u as w,l as z,m as T,t as V,n as J,E as c,i as m,_ as $}from"./index-BHN-jLFm.js";import{a as O,g as W}from"./user-COjPqb4h.js";import{f as X}from"./format-B3wa2IJS.js";const q={class:"upload-root"},A={class:"upload-card"},H={class:"upload-header"},K={key:0,class:"upload-list"},Q={class:"upload-list-header"},Y={key:1},Z={key:2},ee=S({__name:"Upload",setup(le){const i=f([]),p=f(!1),_=f(!1),v=f(""),g=f(""),k=f(),x=l=>{if(console.log("文件大小:",l.size),!(l.size/1024/1024<200))return c.error("文件大小不能超过 200MB!"),!1;const u=[".pdf",".png",".jpg",".jpeg"],o=l.name.toLowerCase().substring(l.name.lastIndexOf("."));return console.log("文件类型:",o),console.log("允许的类型:",u),console.log("是否允许:",u.includes(o)),o===".xls"||o===".xlsx"?(c.error("不支持 Excel 文件上传！"),!1):u.includes(o)?!0:(c.error("不支持的文件类型！仅支持：PDF、Word、PowerPoint、PNG、JPG"),!1)},L=l=>{x(l.raw)&&i.value.push({name:l.name,size:l.size,status:"waiting",raw:l.raw})},U=l=>{const e=i.value.findIndex(u=>u.name===l.name);e!==-1&&i.value.splice(e,1)},P=l=>({waiting:"info",uploading:"warning",success:"success",error:"danger"})[l]||"info",E=l=>({waiting:"等待上传",uploading:"上传中",success:"上传成功",error:"上传失败"})[l]||"未知状态",R=()=>{g.value="";const l=v.value.trim();if(!l){g.value="请输入文档URL";return}if(!/^https?:\/\//.test(l)){g.value="请输入有效的URL（http/https）";return}const e=l.split("/").pop()||"远程文档.pdf";i.value.push({name:e,size:0,status:"waiting",url:l}),_.value=!1,v.value="",c.success("已添加到上传列表")},h=async()=>{var l;if(i.value.length===0){c.warning("请先选择要上传的文件");return}p.value=!0;try{const e=new FormData;i.value.forEach(o=>{o.raw&&e.append("files",o.raw)});const u=await O.post("/api/upload",e,{headers:{"Content-Type":"multipart/form-data","X-User-Id":W()}});u.data&&u.data.total>0?(c.success("文件上传成功，已进入解析队列！"),i.value=[],(l=k.value)==null||l.clearFiles()):c.error("文件上传失败，请重试！")}catch(e){console.error("上传失败:",e),c.error("文件上传失败，请重试！")}finally{p.value=!1}};return(l,e)=>{const u=d("el-icon"),o=d("el-button"),F=d("el-upload"),b=d("el-table-column"),M=d("el-tag"),D=d("el-table"),I=d("el-empty"),N=d("el-input"),j=d("el-form-item"),B=d("el-form"),G=d("el-dialog");return m(),y("div",q,[s("div",A,[s("div",H,[e[7]||(e[7]=s("span",{class:"upload-title"},"点击或拖拽上传文档",-1)),a(o,{class:"url-btn",type:"default",size:"small",plain:"",onClick:e[0]||(e[0]=n=>_.value=!0)},{default:t(()=>[a(u,null,{default:t(()=>e[5]||(e[5]=[s("link",null,null,-1)])),_:1,__:[5]}),e[6]||(e[6]=r(" URL 上传 "))]),_:1,__:[6]})]),a(F,{ref_key:"uploadRef",ref:k,class:"upload-area",drag:"",action:"/api/upload","auto-upload":!1,"on-change":L,"on-remove":U,"before-upload":x,accept:".pdf,.png,.jpg,.jpeg",multiple:"",limit:20,disabled:p.value},{tip:t(()=>e[8]||(e[8]=[s("div",{class:"el-upload__tip"},[r(" 支持的文件类型：PDF、PNG、JPG、JPEG "),s("br"),r(" 单个文档不超过 "),s("b",null,"200M"),r(" 或 "),s("b",null,"600"),r(" 页，单图片不超过 "),s("b",null,"10M"),r("，单次最多 "),s("b",null,"20"),r(" 个文件 ")],-1)])),default:t(()=>[a(u,{class:"el-icon--upload"},{default:t(()=>[a(w(z))]),_:1}),e[9]||(e[9]=s("div",{class:"el-upload__text"},[r(" 拖拽文件到此处，或 "),s("span",{class:"upload-link"},"点击上传")],-1))]),_:1,__:[9]},8,["disabled"]),i.value.length>0?(m(),y("div",K,[s("div",Q,[e[10]||(e[10]=s("span",null,"待上传文件列表",-1)),a(o,{type:"primary",onClick:h,loading:p.value,disabled:p.value||i.value.length===0,size:"small"},{default:t(()=>[p.value?T("",!0):(m(),C(u,{key:0},{default:t(()=>[a(w(z))]),_:1})),p.value?(m(),y("span",Z,"上传中...")):(m(),y("span",Y,"开始上传"))]),_:1},8,["loading","disabled"])]),a(D,{data:i.value,border:"",stripe:""},{default:t(()=>[a(b,{prop:"name",label:"文件名"}),a(b,{prop:"size",label:"大小",width:"120"},{default:t(({row:n})=>[r(V(w(X)(n.size)),1)]),_:1}),a(b,{label:"状态",width:"120"},{default:t(({row:n})=>[a(M,{type:P(n.status)},{default:t(()=>[r(V(E(n.status)),1)]),_:2},1032,["type"])]),_:1}),a(b,{label:"操作",width:"120"},{default:t(({row:n})=>[a(o,{type:"danger",link:"",onClick:ae=>U(n),disabled:n.status==="uploading"||p.value},{default:t(()=>e[11]||(e[11]=[r(" 删除 ")])),_:2,__:[11]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])])):(m(),C(I,{key:1,description:"暂无待上传文件，快来体验智能解析吧！","image-size":100,class:"upload-empty"}))]),a(G,{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=n=>_.value=n),title:"URL 上传",width:"400px","close-on-click-modal":!1},{footer:t(()=>[a(o,{onClick:e[3]||(e[3]=n=>_.value=!1)},{default:t(()=>e[12]||(e[12]=[r("取消")])),_:1,__:[12]}),a(o,{type:"primary",onClick:R},{default:t(()=>e[13]||(e[13]=[r("添加到上传列表")])),_:1,__:[13]})]),default:t(()=>[a(B,{onSubmit:e[2]||(e[2]=J(()=>{},["prevent"]))},{default:t(()=>[a(j,{label:"文档URL",error:g.value},{default:t(()=>[a(N,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=n=>v.value=n),placeholder:"请输入文档下载地址",clearable:""},null,8,["modelValue"])]),_:1},8,["error"])]),_:1})]),_:1},8,["modelValue"])])}}}),ne=$(ee,[["__scopeId","data-v-77e85c66"]]);export{ne as default};
